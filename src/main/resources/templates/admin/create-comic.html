<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Comic</title>
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
</head>
<body>
<div id="root"></div>
<!-- React library -->
<script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/babel">
    const CreateComic = () => {
        const [genres, setGenres] = React.useState([]);

        React.useEffect(() => {
            const loadGenres = async () => {
                try {
                    const response = await fetch('http://localhost:8080/api/genres');
                    if (!response.ok) {
                        throw new Error('Failed to load genres');
                    }
                    const data = await response.json();
                    setGenres(data);
                } catch (error) {
                    console.error('Error loading genres:', error);
                }
            };


            loadGenres();
        }, []);

        const handleSubmit = async (event) => {
            event.preventDefault();

            const formData = new FormData(event.target);

            // Convert selected genre IDs to an array and set the correct key in formData
            const selectedGenres = Array.from(formData.getAll('genres'));
            formData.delete('genres');
            formData.append('genreIds', JSON.stringify(selectedGenres));

            const createComicUrl = 'http://localhost:8080/api/comics/create';

            try {
                const response = await fetch(createComicUrl, {
                    method: 'POST',
                    body: formData,
                    headers: {
                        'Content-Type': 'multipart/form-data',
                    },
                });


                if (!response.ok) {
                    throw new Error('Failed to create comic');
                }

                console.log('Comic created successfully!');
            } catch (error) {
                console.error('Error creating comic:', error);
            }
        };

        return (
            <div className="container">
                <div className="header">
                    <h1>Create Comic</h1>
                </div>
                <div className="content">
                    <div className="form-container">
                        <form id="create-comic-form" encType="multipart/form-data" method = "POST" onSubmit={handleSubmit}>
                            <label htmlFor="title">Title:</label>
                            <input type="text" id="title" name="title" required /><br /><br />
                            <label htmlFor="coverImage">Cover Image:</label>
                            <input type="file" id="coverImage" name="file" accept="image/*" required /><br /><br />
                            <img id="coverPreview" src="#" alt="Cover Preview" style={{ maxWidth: '200px', display: 'none' }} />
                            <label htmlFor="description">Description:</label><br />
                            <textarea id="description" name="description" required></textarea><br /><br />
                            <label htmlFor="status">Status:</label>
                            <input type="text" id="status" name="status" required /><br /><br />
                            <label htmlFor="genres">Genres:</label><br />
                            {genres.map((genre, index) => (
                                <div key={index}>
                                    <input type="checkbox" id={`genre-${genre.id}`} name="genres" value={genre.id} />
                                    <label htmlFor={`genre-${genre.id}`}>{genre.name}</label>
                                </div>
                            ))}

                            <button type="submit">Create Comic</button>
                        </form>
                    </div>
                </div>
            </div>
        );
    };


    ReactDOM.render(<CreateComic />, document.getElementById('root'));
</script>
</body>
</html>
