<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Followed Comics</title>
    <link rel="stylesheet" type="text/css" href="/css/styles.css">
</head>
<body>
<div id="root"></div>

<!-- React library -->
<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<script type="text/babel">
    function FollowedComics({ userId }) {
        const [followedComics, setFollowedComics] = React.useState([]);
        React.useEffect(() => {
            fetch(`http://localhost:8080/api/followed-comics/${userId}`)
                .then((response) => {
                    if (!response.ok) {
                        throw new Error('Failed to fetch followed comics');
                    }
                    return response.json();
                })
                .then((data) => {
                    if (!data || !Array.isArray(data)) {
                        throw new Error('Invalid data format for followed comics');
                    }
                    console.log("Received Followed Comics:", data);
                    setFollowedComics(data);
                })
                .catch((error) => {
                    console.error('Error fetching followed comics:', error);
                });

        }, [userId, setFollowedComics]);

        console.log("Followed Comics State:", followedComics);

        return (
            <div>
                <h2>Followed Comics</h2>
                {followedComics.length > 0 ? (
                    <table>
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Views</th>
                            <th>Follows</th>
                            <th>Rating</th>
                            <th>Status</th>
                            <th>Genres</th>
                            <th>Chapters</th>
                            <th>Cover Image</th>
                        </tr>
                        </thead>
                        <tbody>
                        {followedComics.map((comic) => (
                            <tr key={comic.id}>
                                <td>{comic.comic.id}</td>
                                <td>{comic.comic.title}</td>
                                <td>{comic.comic.description}</td>
                                <td>{comic.comic.viewCount}</td>
                                <td>{comic.comic.followCount}</td>
                                <td>{comic.comic.rating}</td>
                                <td>{comic.comic.status}</td>
                                <td>
                                    {comic.comic.genres && comic.comic.genres.length > 0 ? (
                                        <ul>
                                            {comic.comic.genres.map((genre) => (
                                                <li key={genre.id}>{genre.name}</li>
                                            ))}
                                        </ul>
                                    ) : (
                                        "No genres available"
                                    )}
                                </td>
                                <td>
                                    {comic.comic.chapters && comic.comic.chapters.length > 0 ? (
                                        <ul>
                                            {comic.comic.chapters.map((chapter) => (
                                                // Use <a> tag to create a link to chapter-images.html
                                                <li key={chapter.id}>
                                                    <a
                                                        href={`chapter-images.html?chapterId=${chapter.id}`}
                                                    >
                                                        {chapter.title}
                                                    </a>
                                                </li>
                                            ))}
                                        </ul>
                                    ) : (
                                        "No chapters available"
                                    )}
                                </td>
                                <td>
                                    <img src={comic.comic.coverImage} alt={comic.comic.title} style={{ width: '100px', height: 'auto' }} />
                                </td>
                            </tr>
                        ))}
                        </tbody>
                    </table>
                ) : (
                    <p>No followed comics found.</p>
                )}
            </div>
        );
    }

    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('userId');

    ReactDOM.render(<FollowedComics userId={userId} />, document.getElementById('root'));

</script>
</body>
</html>
